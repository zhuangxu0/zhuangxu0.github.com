---
layout: post
title: "网络笔记-网络层(1)"
date: 2017-07-21 20:35:48
image: '/assets/img/'
description: 'Network Layer学习笔记'
main-class: 'shu'
color: '#7AAB13'
tags:
- "net"
- "shu"
categories:
- Network
twitter_text: 'How to use this template'
introduction: 'How to use this template'
---

# 1. 网络层的梳理
## 1.1 主要问题
网络层是实现主机到主机之间的通信，重要的两个概念是转发和选路。

1. 转发:分组从一个入链路到一台路由器的出链路的传送，涉及一台路由器
　　
* 路由器内部是如何实现分组转发的
* 涉及那些协议
* 数据包的格式和数据包分片
* 网络层编址和地址转换

2. 选路:选路涉及一个网络中的所有路由器，它是决定分组从源节点到目的节点采用的传输路径

* 选路算法，链路状态算法、距离向量算法
* 涉及哪些协议
* 在自治系统内部选路和自治系统之间

3. 连接建立

* 计算机网络中的第三个重要的网络功能

## 1.2 对网络层的理解
网络层就是把数据包从一个主机发送到另一个主机，那么如果设计一个这样的系统需要考虑那些问题呢？
我想把这个考虑成一个工厂生产大物件，需要分块邮递出去到目的地的物流的交通问题

* 从工厂到目的地能交付吗
* 该如何选比较短的路，比较顺畅的路,是工厂指导发送路径，还是快递点自己根据周围情况选择
* 当目的地收到的包裹分块中少了某几个，当包块是个受损的不合格的该如何通知给工场补发
* 包块到达的顺序该不该保证和发出的一样，对于一个包的多个分块该如何保证能正确的拼接起来

* 工厂发货速度能不能进行动态调整
* 当路上很多包造成网络拥堵的时候，当目的地的处理不了的时候，沿途的快递点能不能通知工厂降低发货速度
* 当目的地货少的时候，通知加快速度

* 当网络拥塞时如何处理

* 对于紧急包能否提供优先运输，甚至开辟专有线路

## 1.3 网络层的连接和无连接服务
网络层中提供主机到主机之间的服务，在如今的计算机网络体系结构中（因特网是一种computer network体系结构，还有ＡＴＭ，frame relay），
网络层要么提供有连接的服务（虚电路网络）要么提供无连接的服务（数据包网络），不可能同时提供两种服务

# 2. Router工作原理
Router进行数据包的转发工作，从一条入链路选择一条出链路。对于沿途的快递点可以想到一个包裹来了我要选择从哪个路发出去，对于全国的这个多
的地方我不可能在我的小店中精确到每个消费者的地址我该发到那个路上，而是根据省／市／镇这些大的地址发到那些路上。
这也就是在转发问题中使用的编址和最长前缀匹配。

路由器的结构包括输入端口、交换结构、选路处理器、输出端口，选路处理器执行选路协议，维护选路信息和转发表。


# 3. The Internet Protocol(IP)
# 3.1 网络层的三个主要的组件

* IP协议：编码规则、数据包格式、分组处理规则
* 选路组件：数据包从原地址到目的地址的路径，涉及的选路协议：RIP,OSPF,BGP
* 报告数据包中差错信息和对某些网络层信息请求进行响应的设置,涉及的协议：ICMP差错报告

# 3.2 数据包的格式
几个特殊的字段

* Type of Servie:服务类型，有些包需要优先处理，通过改字段可以标记不同类型的数据包，那些是要求低延迟，高吞吐，那些是实时数据包以及非实时流量
* Identifier,Flags,Fragmentation offest:标记数据分片为了进行重组
* Upper-layer protocol:要交付给上层的协议，ＴＣＰ，ＵＤＰ
* Header checksum:首部检验和，包裹是否是好的

# 3.3 数据分片


# 3.4 IPv4编址
主机和物理链路之间的边界叫做接口，路由器和物理链路之间的边界也叫做接口，每个接口都有一条链路因此对于主机和路由器都可以接受和发送ＩＰ
数据包，所以ＩＰ要求主机和路由器的接口都需要有自己的ＩＰ地址。









# 2. 网络抓包
## 2.1 局域网主机获取
namp工具提供对局域网的扫描等功能,扫扫描后查看缓存表　cat/proc/net/arp<br/>
sudo apt install nmap

nmap -sP 192.168.1.0/24 (ping 该网段)

arp -v (显示ＡＲＰ的缓存信息,得到局域网中的主机地址和硬件地址)